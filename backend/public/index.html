<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé¨ Movie Catalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-4xl font-bold mb-6 text-center text-blue-700">üé¨ Movie Catalog</h1>

    <!-- Add Movie Form -->
    <form id="movieForm" class="bg-white p-4 rounded shadow mb-6 grid grid-cols-2 gap-3">
      <input type="text" id="title" placeholder="Title" class="border p-2 rounded col-span-2" required />
      <input type="text" id="director" placeholder="Director" class="border p-2 rounded" required />
      <input type="text" id="genre" placeholder="Genre" class="border p-2 rounded" required />
      <input type="number" id="release_year" placeholder="Release Year" class="border p-2 rounded" required />
      <input type="number" step="0.1" id="rating" placeholder="Rating" class="border p-2 rounded" required />
      <button class="col-span-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Movie</button>
    </form>

    <!-- Status Message -->
    <p id="statusMsg" class="text-center text-gray-600 mb-4">Loading movies...</p>

    <!-- Movies List -->
    <div id="moviesList" class="grid gap-4 md:grid-cols-2"></div>
  </div>

  <script>
    const API_URL = "http://localhost:5000/movies";

    // Load Movies
    async function loadMovies() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Failed to fetch");
        const movies = await res.json();

        const list = document.getElementById("moviesList");
        const msg = document.getElementById("statusMsg");
        list.innerHTML = "";

        if (movies.length === 0) {
          msg.innerText = "No movies found. Add some!";
          return;
        }
        msg.innerText = "";

        movies.forEach(movie => {
          const div = document.createElement("div");
          div.className = "bg-white p-4 rounded shadow flex flex-col justify-between";
          div.innerHTML = `
            <div>
              <h2 class="text-xl font-semibold">${movie.title}</h2>
              <p class="text-gray-600">${movie.director} | ${movie.genre}</p>
              <p class="text-gray-500">${movie.release_year} | ‚≠ê ${movie.rating}</p>
            </div>
            <div class="mt-3 flex gap-2">
              <button onclick="deleteMovie(${movie.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Delete</button>
              <button onclick="editMovie(${movie.id}, '${movie.title}', '${movie.director}', '${movie.genre}', ${movie.release_year}, ${movie.rating})" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Edit</button>
            </div>
          `;
          list.appendChild(div);
        });
      } catch (err) {
        document.getElementById("statusMsg").innerText = "‚ö†Ô∏è Error loading movies.";
      }
    }

    // Add Movie
    document.getElementById("movieForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const movie = {
        title: document.getElementById("title").value,
        director: document.getElementById("director").value,
        genre: document.getElementById("genre").value,
        release_year: document.getElementById("release_year").value,
        rating: document.getElementById("rating").value,
      };
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(movie)
      });
      e.target.reset();
      loadMovies();
    });

    // Delete Movie
    async function deleteMovie(id) {
      await fetch(`${API_URL}/${id}`, { method: "DELETE" });
      loadMovies();
    }

    // Edit Movie
    async function editMovie(id, title, director, genre, release_year, rating) {
      // Pre-fill form
      document.getElementById("title").value = title;
      document.getElementById("director").value = director;
      document.getElementById("genre").value = genre;
      document.getElementById("release_year").value = release_year;
      document.getElementById("rating").value = rating;

      const form = document.getElementById("movieForm");
      form.onsubmit = async (e) => {
        e.preventDefault();
        const updatedMovie = {
          title: document.getElementById("title").value,
          director: document.getElementById("director").value,
          genre: document.getElementById("genre").value,
          release_year: document.getElementById("release_year").value,
          rating: document.getElementById("rating").value,
        };
        await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedMovie)
        });
        form.reset();
        form.onsubmit = null; // reset handler
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
        });
        loadMovies();
      };
    }

    loadMovies();
  </script>
</body>
</html>
